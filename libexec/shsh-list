#!/usr/bin/env sh
#
# Summary: List installed packages
# Usage: shsh list [-d|--details]
#
# --details: when give, the URL of the repository will be displayed

set -e

case $1 in
  -d|--details)
    show_details="true"
    shift
  ;;
esac

if [ "$#" -gt 0 ]; then
  shsh-help list
  exit 1
fi

for package_path in "${SHSH_PACKAGES_PATH}"/*/*; do
  [ -e "$package_path" ] || [ -L "$package_path" ] || continue

  username="$(dirname "$package_path")"
  username="${username##*/}"
  package="${package_path##*/}"
  if [ -z "$show_details" ]; then
    echo "$username/$package"
  else
    printf "%-30s %-30s\n" "$username/$package" "($(git --git-dir="${SHSH_PACKAGES_PATH}/$username/$package/".git config --get remote.origin.url))"
  fi
done
